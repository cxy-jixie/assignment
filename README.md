# 第七章：机械臂运动学
## 7.1 描述一台机械臂
1. 机械臂组成：一组被称为连杆的刚体组成的，由关节组成，每个关节有平动或转动的自由度，通常大部分机器人的关节都是回转的；
2. R代表转动副，P是移动副；D-H参数法用来描述串联式链路上连杆和关节的几何关系的系统方法；
3. 有N个关节就有(N+1)个连杆，代号0的为机器人的基座，代号为N的为末端连接工具
4. 一个关节有由两个参数来描述；dj表示沿关节轴线从一个连杆坐标到另一个连杆坐标系的距离，而另一参数是连杆相对于另一个连杆关于关节轴线的转动角度
5. 从{j-1}到{j}的变换被定义为基本旋转与平移形式为：$j-1Aj(pj,dj,aj,fj)=TRz(pj)Tz(dj)Tx(aj)TRz(fj) $
6. 
~~~ matlab
>>  l=Link([0,0.1,0.2,pi/2,0])
 
l = 
Revolute(std): theta=q, d=0.1, a=0.2, alpha=1.5708, offset=0
>> %特别Link 与link不一样；
>> l.A(0.5)
 

ans = 
    0.8776         0    0.4794    0.1755
    0.4794         0   -0.8776   0.09589
         0         1         0       0.1
         0         0         0         1
>> 
~~~
## 7.2 正运动学
### 7.2.1 两连杆机器人
1. 
~~~ matlab
>>  l(1)=Link([0 0 1 0]);
>> l(2)=Link([0 0 1 0]);
>> l
 
l = 
Revolute(std):  theta=q1   d=0           a=1           alpha=0           offset=0          
Revolute(std):  theta=q2   d=0           a=1           alpha=0           offset=0          
>> %offset补偿
>> two_link=SerialLink(l,'name','two link');
>> two_link
 
two_link = 
 
two link:: 2 axis, RR, stdDH, slowRNE                            
+---+-----------+-----------+-----------+-----------+-----------+
| j |     theta |         d |         a |     alpha |    offset |
+---+-----------+-----------+-----------+-----------+-----------+
|  1|         q1|          0|          1|          0|          0|
|  2|         q2|          0|          1|          0|          0|
+---+-----------+-----------+-----------+-----------+-----------+
%问题：为什么不出现书上后两行；
>>  mdl_planar2
>> p2
 
p2 = 
 
planar 2 link:: 2 axis, RR, stdDH, slowRNE                       
+---+-----------+-----------+-----------+-----------+-----------+
| j |     theta |         d |         a |     alpha |    offset |
+---+-----------+-----------+-----------+-----------+-----------+
|  1|         q1|          0|          1|          0|          0|
|  2|         q2|          0|          1|          0|          0|
+---+-----------+-----------+-----------+-----------+-----------+
%和上面效果相同
 ~~~
2.
~~~matlab
> clone=SerialLink(two_link,'name','bob')
 
clone = 
 
bob:: 2 axis, RR, stdDH, slowRNE                                 
+---+-----------+-----------+-----------+-----------+-----------+
| j |     theta |         d |         a |     alpha |    offset |
+---+-----------+-----------+-----------+-----------+-----------+
|  1|         q1|          0|          1|          0|          0|
|  2|         q2|          0|          1|          0|          0|
+---+-----------+-----------+-----------+-----------+-----------+
 
>> two_link.fkine([0 0])
 

ans = 
         1         0         0         2
         0         1         0         0
         0         0         1         0
         0         0         0         1
>> help fkine
    fkine 为实时脚本。

    在实时编辑器中打开

    名为 fkine 的其他函数

       SerialLink/fkine

>> two_link.plot([0,0])
>> two_link.plot([pi/4,-pi/4])
~~~
### 7.2.2 六轴机器人
1. 有6个自由度：其中3个平移3个转动；
2. 尝试用第一种方式创建
~~~ matlab
%建立机器人模型
%       theta    d        a        alpha     offset
L1=Link([0       0.4      0.025    pi/2      0     ]); %定义连杆的D-H参数
L2=Link([pi/2    0        0.56     0         0     ]);
L3=Link([0       0        0.035    pi/2      0     ]);
L4=Link([0       0.515    0        pi/2      0     ]);
L5=Link([pi      0        0        pi/2      0     ]);
L6=Link([0       0.08     0        0         0     ]);
robot=SerialLink([L1 L2 L3 L4 L5 L6],'name','daer'); %连接连杆，机器人取名daer
robot.plot([0,pi/2,0,0,pi,0]);%输出机器人模型，后面的六个角为输出时的theta姿态
~~~
3. 用第二种方式创建
~~~ matlab
>> mdl_puma560
>> p560
 
p560 = 
 
Puma 560 [Unimation]:: 6 axis, RRRRRR, stdDH, slowRNE            
 - viscous friction; params of 8/95;                             
+---+-----------+-----------+-----------+-----------+-----------+
| j |     theta |         d |         a |     alpha |    offset |
+---+-----------+-----------+-----------+-----------+-----------+
|  1|         q1|          0|          0|     1.5708|          0|
|  2|         q2|          0|     0.4318|          0|          0|
|  3|         q3|    0.15005|     0.0203|    -1.5708|          0|
|  4|         q4|     0.4318|          0|     1.5708|          0|
|  5|         q5|          0|          0|    -1.5708|          0|
|  6|         q6|          0|          0|          0|          0|
+---+-----------+-----------+-----------+-----------+-----------+
 
>> p560.plot(qz)
>> p560.plot(qr)
>> p560.fkine(qz)
 

ans = 
         1         0         0    0.4521
         0         1         0     -0.15
         0         0         1    0.4318
         0         0         0         1
>> % 可以定义一个变化使坐标系变化到实际工具所在位置
>> p560.tool=transl(0,0,0.2);
>> %同理将原点平移到底座的下端面
>> p560.base=transl(0,0,30*0.0254);
>> %问题0.0254在这代表什么；
>> p560.plot(qz)
>> p560.base=transl(0,0,3)*trotx(pi);
>> p560.plot(qz)
>> p560.plot(qr)
>> p560.base=transl(0,0,0.02)*trotx(pi);
>> p560.plot(qr)
~~~
## 7.3 逆运动学
### 7.3.1 封闭形式解
1. 
~~~ matlab
>> mdl_puma560
>> qn

qn =

         0    0.7854    3.1416         0    0.7854         0

>> T=p560.fkine(qn)
 

T = 
         0         0         1    0.5963
         0         1         0   -0.1501
        -1         0         0  -0.01435
         0         0         0         1
>> qi=p560.fkine(qi)
函数或变量 'qi' 无法识别。
 
>> qi=p560.ikine6s(T)

qi =

    2.6486   -3.9270    0.0940    2.5326    0.9743    0.3734

>> p560.fkine(qi)
 

ans = 
         0         0         1    0.5963
         0         1         0     -0.15
        -1         0         0  -0.01435
         0         0         0         1
>> %两组不同的关节坐标却得到了同样的结论
>> %所以涉及到了左手位形与右手位形
>> qi=p560.ikne6s(T,'ru')
未识别类 'SerialLink' 的方法、属性或字段 'ikne6s'。
 
是不是想输入:
>> qi=p560.ikine6s(T,'ru')

qi =

   -0.0000    0.7854    3.1416   -0.0000    0.7854    0.0000
%左手或右手	'l'，'r'
%肘部在上或在下	'u'，'d'
%手腕是否翻转	'f'，'n'
%由于碰撞等因素所以不是8个都能工作
~~~
2. 有的位姿不能有有效的解，因为可能手臂长度不够长够不到，也可能处在奇异点出现万向节锁问题逆解函数可以限制两关节角度之和
### 7.3.2 数值解
1. 通用数值解适用于不具有6个关节与球腕的机器人
2. 使用函数‘ikine’
3. 局限在于不能像解析法一样对手臂运动位形进行良好的控制，但可以求解奇异点以及非6关节型的机械臂
### 7.3.3 欠驱动的机械臂
1. ☞关节数少于6个机械臂
2. 可以要求ikine方法只考虑x轴与y轴的笛卡尔坐标自由度，所以要添加
遮盖向量作为第四个参数，具体方法如下：
~~~ matlab
q=twolink.fkine(T,[0 0],[1 1 0 0 0 0])
%可得到两轴的平移量但另外的参数是不正确的；
~~~
### 7.3.4 冗余机械臂
1. 是指多余6个关节的机器人
2. 实例
~~~ matlab
>> mdl_puma560
 
>> platform=SerialLink([0 0 0 -pi/2 1;-pi/2 0 0 pi/2 1],'base',troty(pi/2),'name','platform')
 
platform = 
 
platform:: 2 axis, PP, stdDH, slowRNE                            
+---+-----------+-----------+-----------+-----------+-----------+
| j |     theta |         d |         a |     alpha |    offset |
+---+-----------+-----------+-----------+-----------+-----------+
|  1|          0|         q1|          0|    -1.5708|          0|
|  2|    -1.5708|         q2|          0|     1.5708|          0|
+---+-----------+-----------+-----------+-----------+-----------+
base:    t = (0, 0, 0), RPY/xyz = (0, 1.57, 0) deg               
 
是不是想输入:
>> platform.fkine([1,2])
 

ans = 
    0.0274         0   -0.9996   0.02741
         0         1         0         2
    0.9996         0    0.0274    0.9996
         0         0         0         1
>> p8=platform*p560
 
p8 = 
 
platform+Puma 560:: 8 axis, PPRRRRRR, stdDH, slowRNE             
+---+-----------+-----------+-----------+-----------+-----------+
| j |     theta |         d |         a |     alpha |    offset |
+---+-----------+-----------+-----------+-----------+-----------+
|  1|          0|         q1|          0|    -1.5708|          0|
|  2|    -1.5708|         q2|          0|     1.5708|          0|
|  3|         q3|          0|          0|     1.5708|          0|
|  4|         q4|          0|     0.4318|          0|          0|
|  5|         q5|    0.15005|     0.0203|    -1.5708|          0|
|  6|         q6|     0.4318|          0|     1.5708|          0|
|  7|         q7|          0|          0|    -1.5708|          0|
|  8|         q8|          0|          0|          0|          0|
+---+-----------+-----------+-----------+-----------+-----------+
base:    t = (0, 0, 0), RPY/xyz = (0, 1.57, 0) deg               
 
>> p560.links(1).d=30*0.0254
 
p560 = 
 
Puma 560 [Unimation]:: 6 axis, RRRRRR, stdDH, slowRNE            
 - viscous friction; params of 8/95;                             
+---+-----------+-----------+-----------+-----------+-----------+
| j |     theta |         d |         a |     alpha |    offset |
+---+-----------+-----------+-----------+-----------+-----------+
|  1|         q1|      0.762|          0|     1.5708|          0|
|  2|         q2|          0|     0.4318|          0|          0|
|  3|         q3|    0.15005|     0.0203|    -1.5708|          0|
|  4|         q4|     0.4318|          0|     1.5708|          0|
|  5|         q5|          0|          0|    -1.5708|          0|
|  6|         q6|          0|          0|          0|          0|
+---+-----------+-----------+-----------+-----------+-----------+
 ~~~
 3. 相较于6轴更加灵活；

 
